{% extends 'timepiece/time-sheet/base.html' %}
{% load timepiece_tags %}

{% block title %}Timepiece Entries{% endblock %}

{% block content %}
<h2>My Time Sheet</h2>
<ul class='header-actions-left'>
    <li><a href="{% url timepiece-clock-in %}">Clock In</a></li>
    <li><a href="{% url timepiece-add %}">Add Entry</a></li>
</ul>

<h3>My Projects</h3>
<table class='my-projects'>
	<tr><th>Project</th><th>My Hours</th><th>Hours Worked</th><th>Hours Remaining</th><th>Due Date</th><th></th></tr>
	{% regroup assignments by contract.project.type as type_list %}
	{% for type in type_list %}
	<tr><th colspan='6'>{{ type.grouper }}s</th></tr>
	{% for assignment in type.list %}
	<tr>
	   <td>{{ assignment.contract.project }}</td>
       <td class='hours'>{{ assignment.num_hours }}</td>
       <td class='hours'>{{ assignment.hours_worked|floatformat:2 }} ({% widthratio assignment.hours_worked assignment.num_hours 100 %}%)</td>
       <td class='hours'>{{ assignment.hours_remaining|floatformat:2 }}</td>
       <td>{{ assignment.end_date }}</td>
       <td>
			<ul class='actions'>
			    <li><a href="{% url timepiece-clock-in %}?project={{ assignment.contract.project.pk }}">Clock In</a></li>
			    <li><a href="{% url timepiece-add %}?project={{ assignment.contract.project.pk }}">Add Entry</a></li>
			</ul>
       </td>
	</tr>
	{% endfor %}
	{% endfor %}
</table>

<h3>
    {% with entries.count as num_entries %}
        My Active Entries
    {% endwith %}
</h3>

{% with my_active_entries as entries %}
{% include 'timepiece/time-sheet/_entry_list.html' %}
{% endwith %}

{% if project_entries %}
    <table id='project-summary' class='timepiece-summary'>
        <caption>My work this week:</caption>
    {% for entry in project_entries %}
        <tr>
            <td>{{ entry.project__name }} </td>
            <td>{{ entry.sum }}</td>
        </tr>
    {% endfor %}
    {% for row in activity_entries %}
        <tr>
            <th>Total {% if row.billable %}billable{% else %}non-billable{% endif %} time:</th>
            <td>{{ row.sum }}</td>
        </tr>
    {% endfor %}
    </table>
{% endif %}

{% if others_active_entries %}
    <table id='active-entries' class='timepiece-summary'>
        <caption>Others are working on:</caption>
    {% for entry in others_active_entries %}
        <tr class='{% if entry.is_paused %}paused{% endif %}'>
            <td>{{ entry.user.first_name }} {{ entry.user.last_name }}</td>
            <td>{{ entry.project.name }}</td>
            <td>{{ entry.start_time|date:"P" }}</td>
        </tr>
    {% endfor %}
    </table>
{% endif %}

<br style='clear: both;' />

<h3>
    {% with this_weeks_entries.count as num_entries %}
        Time Detail This Week ({{ num_entries }} entr{{ num_entries|pluralize:"y,ies" }})
    {% endwith %}
</h3>

{% with this_weeks_entries as entries %}
{% include 'timepiece/time-sheet/_entry_list.html' %}
{% endwith %}

{% endblock %}

