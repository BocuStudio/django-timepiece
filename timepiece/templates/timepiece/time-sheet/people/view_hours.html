{% extends 'timepiece/time-sheet/base.html' %}
{% load timepiece_tags %}

{% block title %}{{ person }} Hourly Summary{% endblock %}

{% block content %}
<h2>{{ person.first_name }} {{ person.last_name}}'s Hourly Summary ({{ window.date|date:"N j" }} &mdash; {{ window.end_date|date:"N j" }})</h2>
<ul class='header-actions-left'>
    <li>
        {% if perms.timepiece.view_user %}
            <a href='{% url view_person person.pk %}'>User Information</a>
        {% endif %}
    </li>
    <li>
        {% if perms.timepiece.view_user %}
            <a href='{% url view_person_time_sheet person.pk, window.period.pk, window.pk %}'>Time Sheet</a>
        {% endif %}
    </li>
    <li>
        {% if perms.timepiece.view_user %}
            Hourly Summary
        {% endif %}
    </li>
    <li>
        {% if window.previous %}
            <a href='{% url view_person_time_sheet person.pk,window.period.pk,window.previous.pk, hourly %}'>Previous Time Sheet</a>
        {% else %}
            Previous Time Sheet
        {% endif %}
    </li>
    <li>
        {% if window.next %}
            <a href='{% url view_person_time_sheet person.pk,window.period.pk,window.next.pk, hourly %}'>Next Time Sheet</a>
        {% else %}
            Next Time Sheet
        {% endif %}
    </li>
</ul>

{% if entries %}
    <table>    
        <tr>
            <th colspan='2'>Date</th>
            <th colspan='2'>Project</th>
            <th>Hours</th>
        </tr>
        {% for entry in entries %}
            {% ifchanged entry.day|date:"W" %}
                <tr>
                    <th colspan='5'>Week of {{ entry.day|date:"m/d/Y (D)" }} </th>
                </tr>
            {% endifchanged %}
            <tr>
                {% ifchanged entry.day %}
                    <td colspan='2'>{{ entry.day|date:"m/d/Y (D)" }}</td>
                {% else %}
                    <td colspan='2'></td>
                {% endifchanged %}
            <td colspan='2'>{{ entry.project__name }}</td>
            <td>{{ entry.total_hours|floatformat:2 }}</td>
            {% if forloop.counter in week_rows %}
                <tr>
                    <th colspan='2'>Totals for this week:</th>
                    <th>Billable:</th>
                    <th>Non Billable:</th>
                    <th>Total:</th>
                </tr>
                <tr>
                    <th colspan='2'></th>
                    {% show_week_row weekly_totals entry.day %}
                </tr>
            {% endif %}
        {% endfor %}
        <tr>
            <th colspan='3'>Overall total for the period:</th>
            <td>{{ total|floatformat:2 }}</td>
        </tr>
    </table>
{% else %}
    <p>No entries exist for this time sheet.</p>
{% endif %}

<br style='clear: both' />

{% endblock %}
